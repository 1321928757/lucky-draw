# è¥é”€æŠ½å¥–ç³»ç»Ÿ - By åˆ˜ä»•æ°

é¡¹ç›®å‡ºå¤„:å°å‚…å“¥ï¼Œ[**å°å‚…å“¥çš„åšå®¢**](https://bugstack.cn)
å°å‚…å“¥çœŸçš„æ˜¯è¸å®åˆ†äº«æŠ€æœ¯çš„åšä¸»ï¼Œæœ‰æƒ³è¦æå‡è‡ªå·±èƒ½åŠ›çš„éƒ½å¯ä»¥åŠ å…¥å°å‚…å“¥çš„æ˜Ÿçƒï¼Œå¼ºçƒˆæ¨è~

ä»£ç ä¸ä¼šå…¨éƒ¨ä¸Šä¼ ï¼Œæƒ³è¦ç»§ç»­å­¦ä¹ çš„åŒå­¦å¯ä»¥åŠ å…¥å°å‚…å“¥çš„æ˜Ÿçƒå­¦ä¹ ï¼Œè°¢è°¢ç†è§£

é¡¹ç›®ä»‹ç»ï¼šè¥é”€æŠ½å¥–ç³»ç»Ÿæ˜¯å„ä¸ªäº’è”ç½‘å…¬å¸ç”¨äºæ‹‰æ–°ã€ä¿ƒæ´»ã€ç•™å­˜ã€è½¬åŒ–çš„é‡è¦æ‰‹æ®µï¼Œæ­¤é¡¹ç›®é’ˆå¯¹é«˜å¹¶å‘åœºæ™¯ï¼Œæ­å»ºä¸ºå„å¹³å°ä¿ƒé”€ææ•ˆçš„è¥é”€æŠ½å¥–å¹³å°ï¼Œç®¡ç†å‘˜å¯é€šè¿‡åå°ç®¡ç†æ´»åŠ¨ä¸å¥–å“ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŠ½å¥–çš„æ–¹å¼è·å–å¥–å“ï¼Œåœ¨å¯»å¸¸æŠ½å¥–çš„åŸºç¡€ä¸Šæ‰©å±•äº†é»‘åå•ç”¨æˆ·å…œåº•ï¼Œç”¨æˆ·æƒé‡åˆ†æï¼Œæ¬¡æ•°è§£é”å¥–å“ï¼Œå…œåº•å¥–å“éšæœºç§¯åˆ†ç­‰åŠŸèƒ½ã€‚æ•´ä½“é‡‡ç”¨DDDæ¶æ„è®¾è®¡ï¼Œæ”¯æŒåˆ†å¸ƒå¼æ°´å¹³æ‰©å±•ï¼Œå•å®ä¾‹éƒ¨ç½²ä¸‹QPSå®æµ‹1000å·¦å³ã€‚

æ ¸å¿ƒæŠ€æœ¯ï¼šSpringBootã€MyBatisã€MySQLã€Redisã€Redissonã€Guavaã€RabbitMQã€‚

å‰ç«¯å¾ˆç®€å•ï¼Œæ•…å°±æ²¡æœ‰ä¸Šä¼ äº†ï¼Œä½¿ç”¨äº† https://100px.net/ è¿™ä¸ªå¤§è½¬ç›˜æ’ä»¶ï¼Œvue/react/åŸç”Ÿjséƒ½å¯ä»¥å®ç°çš„

---

>**ä½œè€…**ï¼šLuckySJ-åˆ˜ä»•æ° - åœ¨çº¿æ¼”ç¤ºåœ°å€ [**www.luckylottery.site**](www.luckylottery.site)

## è¿è¡Œé…ç½®

- è¿è¡Œç¯å¢ƒï¼šJDK 1.8+
- Springbootï¼š2.7.12
- mysqlï¼š8.2
- redisï¼š5.0

## åç«¯å¼€å‘è¿›åº¦
- âœ…æŠ½å¥–ç­–ç•¥å’Œå¥–å“åº“è¡¨è®¾è®¡
- âœ…æŠ½å–æ¦‚ç‡åŒºé—´ç®—æ³•å®ç°
- âœ…æ¦‚ç‡é¢„è£…é…ï¼Œæƒé‡æ¦‚ç‡é¢„è£…é…
- âœ…æŠ½å¥–å‰ï¼Œè´£ä»»é“¾è§„åˆ™æ ¡éªŒ(é»‘åå•å¤„ç†ï¼Œæƒé‡å¤„ç†ï¼ŒæŠ½å–å¤„ç†)
- âœ…æŠ½å¥–åï¼Œé…åˆæ•°æ®åº“æ„å»ºå†³ç­–æ ‘ï¼Œå®Œæˆæ¬¡æ•°é”åˆ¤æ–­ï¼Œåº“å­˜æ‰£å‡åˆ¤æ–­ï¼Œå…œåº•å¤„ç†ç­‰åˆ†æ”¯æµç¨‹
- âœ…å®ç°æ´»åŠ¨ä¸ç”¨æˆ·çš„åº“è¡¨è®¾è®¡
- ğŸ”¥å®ç°åˆ†åº“åˆ†è¡¨(åˆ©ç”¨ä¸€ä¸ªå°å·§çš„åˆ†åº“åˆ†ç»„å¼€æºç»„ä»¶ï¼Œä¸ªäººè®¤ä¸ºshardingsphereä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ä¸çµæ´»)
- å®ç°æ´»åŠ¨å‘å¸ƒæµç¨‹(åå°å‘å¸ƒæ´»åŠ¨ -> æ¦‚ç‡åŒºé—´ç­‰ç¼“å­˜æ•°æ®é¢„çƒ­ -> ç­‰å¾…åˆ°å¼€å¯æ´»åŠ¨æ—¶é—´)
- å®ç°è·å¥–æ•°æ®å…¥åº“
- å®ç°å‘è´§åŠŸèƒ½(å®Œæˆè·å¥–äººä¿¡æ¯å¡«å†™ï¼Œè¿›è¡Œå¥–å“å‘è´§ï¼Œè¿™é‡Œæœ‰æ—¶é—´çš„è¯ä¼šå°è¯•å¯¹æ¥å¤§è¯­è¨€æ¨¡å‹å¹³å°)

## æœ¬ç« èŠ‚åˆ†åº“åˆ†è¡¨ç»„ä»¶ä½¿ç”¨æ•™ç¨‹

**ä¾èµ–å¯¼å…¥**

```xml
<dependency>
    <groupId>cn.bugstack.middleware</groupId>
    <artifactId>db-router-spring-boot-starter</artifactId>
    <version>1.0.2</version>
</dependency>
```

**è·¯ç”±é…ç½® **

```yaml
# å¤šæ•°æ®æºè·¯ç”±é…ç½®ï¼Œåº“æ•°é‡ * è¡¨æ•°é‡ ä¸º2çš„æ¬¡å¹‚ï¼Œå¦‚2åº“4è¡¨
# mysql 5.x é…ç½® driver-class-name: com.mysql.jdbc.Driver    mysql-connector-java 5.1.34
# mysql 8.x é…ç½® driver-class-name: com.mysql.cj.jdbc.Driver mysql-connector-java 8.0.22
mini-db-router:
  jdbc:
    datasource:
      dbCount: 2 #åˆ†åº“æ•°é‡(å¿…éœ€é…ç½®ï¼Œè·¯ç”±ç»„ä»¶ä¼šæ ¹æ®è¿™ä¸ªå€¼è®¡ç®—å‡ºè·¯ç”±å€¼)
      tbCount: 4 #åˆ†è¡¨æ•°é‡(å¿…éœ€é…ç½®ï¼Œè·¯ç”±ç»„ä»¶ä¼šæ ¹æ®è¿™ä¸ªå€¼è®¡ç®—å‡ºè·¯ç”±å€¼)
      default: db00	#ä¸»åº“(è¿™ä¸ªåº“ä¸å­˜æ”¾åˆ†è¡¨ç›¸å…³ä¿¡æ¯ï¼Œä½œä¸ºä¸€ä¸ªé…ç½®ä¸»è¡¨)
      routerKey: userId  #æ ¹æ®å“ªä¸ªå±æ€§æ¥è¿›è¡Œè·¯ç”±æ“ä½œï¼Œç”¨æˆ·idç”¨å¾—æ¯”è¾ƒå¤š
      list: db01,db02 #åˆ†åº“
      db00:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://127.0.0.1:3306/big_market?useUnicode=true&characterEncoding=utf8&autoReconnect=true&zeroDateTimeBehavior=convertToNull&serverTimezone=UTC&useSSL=true
        username: root
        password: 123123
        type-class-name: com.zaxxer.hikari.HikariDataSource #è¿æ¥æ± é…ç½®
        pool:
          pool-name: Retail_HikariCP
          minimum-idle: 15 #æœ€å°ç©ºé—²è¿æ¥æ•°é‡
          idle-timeout: 180000 #ç©ºé—²è¿æ¥å­˜æ´»æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤600000ï¼ˆ10åˆ†é’Ÿï¼‰
          maximum-pool-size: 25 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯10
          auto-commit: true  #æ­¤å±æ€§æ§åˆ¶ä»æ± è¿”å›çš„è¿æ¥çš„é»˜è®¤è‡ªåŠ¨æäº¤è¡Œä¸º,é»˜è®¤å€¼ï¼štrue
          max-lifetime: 1800000 #æ­¤å±æ€§æ§åˆ¶æ± ä¸­è¿æ¥çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼Œå€¼0è¡¨ç¤ºæ— é™ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤1800000å³30åˆ†é’Ÿ
          connection-timeout: 30000 #æ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´,é»˜è®¤30ç§’ï¼Œå³30000
          connection-test-query: SELECT 1
      db01:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://127.0.0.1:3306/big_market_01?useUnicode=true&characterEncoding=utf8&autoReconnect=true&zeroDateTimeBehavior=convertToNull&serverTimezone=UTC&useSSL=true
        username: root
        password: lsj20030222
        type-class-name: com.zaxxer.hikari.HikariDataSource
        pool:
          pool-name: Retail_HikariCP
          minimum-idle: 15 #æœ€å°ç©ºé—²è¿æ¥æ•°é‡
          idle-timeout: 180000 #ç©ºé—²è¿æ¥å­˜æ´»æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤600000ï¼ˆ10åˆ†é’Ÿï¼‰
          maximum-pool-size: 25 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯10
          auto-commit: true  #æ­¤å±æ€§æ§åˆ¶ä»æ± è¿”å›çš„è¿æ¥çš„é»˜è®¤è‡ªåŠ¨æäº¤è¡Œä¸º,é»˜è®¤å€¼ï¼štrue
          max-lifetime: 1800000 #æ­¤å±æ€§æ§åˆ¶æ± ä¸­è¿æ¥çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼Œå€¼0è¡¨ç¤ºæ— é™ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤1800000å³30åˆ†é’Ÿ
          connection-timeout: 30000 #æ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´,é»˜è®¤30ç§’ï¼Œå³30000
          connection-test-query: SELECT 1
      db02:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://127.0.0.1:3306/big_market_02?useUnicode=true&characterEncoding=utf8&autoReconnect=true&zeroDateTimeBehavior=convertToNull&serverTimezone=UTC&useSSL=true
        username: root
        password: lsj20030222
        type-class-name: com.zaxxer.hikari.HikariDataSource
        pool:
          pool-name: Retail_HikariCP
          minimum-idle: 15 #æœ€å°ç©ºé—²è¿æ¥æ•°é‡
          idle-timeout: 180000 #ç©ºé—²è¿æ¥å­˜æ´»æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤600000ï¼ˆ10åˆ†é’Ÿï¼‰
          maximum-pool-size: 25 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯10
          auto-commit: true  #æ­¤å±æ€§æ§åˆ¶ä»æ± è¿”å›çš„è¿æ¥çš„é»˜è®¤è‡ªåŠ¨æäº¤è¡Œä¸º,é»˜è®¤å€¼ï¼štrue
          max-lifetime: 1800000 #æ­¤å±æ€§æ§åˆ¶æ± ä¸­è¿æ¥çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼Œå€¼0è¡¨ç¤ºæ— é™ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤1800000å³30åˆ†é’Ÿ
          connection-timeout: 30000 #æ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´,é»˜è®¤30ç§’ï¼Œå³30000
          connection-test-query: SELECT 1
```

**åœ¨daoå±‚ä½¿ç”¨æ³¨è§£æŒ‡å®šæ˜¯å¦èµ°è·¯ç”±è§„åˆ™**

è¿™æ˜¯æˆ‘è®¤ä¸ºè¿™ä¸ªç»„ä»¶æœ€å¥½ç”¨çš„ä¸€ç‚¹å°±æ˜¯ï¼Œé€šè¿‡æ³¨è§£å¯ä»¥æŒ‡å®šå“ªäº›daoè¦èµ°è·¯ç”±

```java
@Mapper
@DBRouterStrategy(splitTable = true) //å¼€å¯åˆ†åº“åˆ†è¡¨(splitTableå±æ€§ä»£è¡¨æ˜¯å¦å¼€å¯åˆ†è¡¨)
public interface IRaffleActivityOrderDao {

    @DBRouter(key = "userId") //è·¯ç”±é”®
    void insert(RaffleActivityOrder raffleActivityOrder);

    @DBRouter
    List<RaffleActivityOrder> queryRaffleActivityOrderByUserId(String userId);

}

```

**å•å…ƒæµ‹è¯•**

```java
// æµ‹è¯•åˆ†åº“åˆ†è¡¨æ’å…¥å…ƒç´ 
    @Test
    public void test_insert_random() {
        for (int i = 0; i < 5; i++) {
            RaffleActivityOrder raffleActivityOrder = new RaffleActivityOrder();
            // EasyRandom å¯ä»¥é€šè¿‡æŒ‡å®šå¯¹è±¡ç±»çš„æ–¹å¼ï¼Œéšæœºç”Ÿæˆå¯¹è±¡å€¼ã€‚å¦‚ï¼›easyRandom.nextObject(String.class)ã€easyRandom.nextObject(RaffleActivityOrder.class)
            raffleActivityOrder.setUserId(easyRandom.nextObject(String.class));
            raffleActivityOrder.setActivityId(100301L);
            raffleActivityOrder.setActivityName("æµ‹è¯•æ´»åŠ¨");
            raffleActivityOrder.setStrategyId(100006L);
            raffleActivityOrder.setOrderId(RandomStringUtils.randomNumeric(12));
            raffleActivityOrder.setOrderTime(new Date());
            raffleActivityOrder.setState("not_used");
            // æ’å…¥æ•°æ®
            raffleActivityOrderDao.insert(raffleActivityOrder);
        }
    }
```



## å‰ç«¯å¼€å‘è¿›åº¦
å‰ç«¯æä¾›äº†vue2 vue3ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ/docs/web/vueå’Œ/docs/web/vue3

vue2ç‰ˆæœ¬

```
npm install
npm run dev
```

vue3ç‰ˆæœ¬

```
yarn install
yarn run dev
```
- âœ…å®ç°æŠ½å¥–åŠŸèƒ½
- ğŸ”¥å®ç°æ´»åŠ¨è¯´æ˜ï¼Œæ´»åŠ¨æ¦‚ç‡è¯´æ˜ç­‰ä¿¡æ¯
- å®ç°åå°-æ´»åŠ¨å‘å¸ƒ
- å®ç°åå°-æ•°æ®ç»Ÿè®¡



